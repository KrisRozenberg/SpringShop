<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CraftShop</title>
    <link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css}" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="../static/styles.css" th:href="@{/styles.css}">
</head>

<body>
<header th:insert="fragment/header"></header>

<div class="container">
    <p th:if="${orderMessage}" th:utext="${orderMessage}"></p>

    <table class="table">
        <div th:each="product: ${allProducts}">
            <tbody th:if="${productsInCart.containsKey(product.productId)}">
            <tr>
                <td><img th:src="${product.imageUrl}" class="basket-image" width="100%" height="100%" alt="..."></td>
                <td><p class="product-name basket-product-name" th:utext="${product.name}"></p></td>
                <td><p>Цена: <span th:utext="${product.price}"></span></p></td>
                <td>
                    <div class="list-view">
                        <div class="btn-group">
                            <form th:action="@{/removeInCart}" th:method="post" >
                                <button type="submit" th:name="productId" th:value="${product.productId}" class="btn btn-sm btn-secondary">-</button>
                            </form>
                            <p class="btn" th:utext="${productsInCart.get(product.productId)}"></p>
                            <form th:action="@{/addInCart}" th:method="post" >
                                <button type="submit" th:name="productId" th:value="${product.productId}" class="btn btn-sm btn-secondary">+</button>
                            </form>
                        </div>
                        <small class="text-muted">В наличии:
                            <span th:if="${product.quantity} > 50">50+</span>
                            <span th:unless="${product.quantity} > 50" th:utext="${product.quantity}"></span>
                        </small>
                    </div>
                </td>
            </tr>
            </tbody>
        </div>
    </table>

    </br>
    <div th:field="${productsInCart.productQuantity}" th:if="${#fields.hasErrors('productsInCart.productQuantity')}"
         th:errors="${productsInCart.productQuantity}">Quantity Error</div>

    </br>
    <form th:action="@{/makeOrder}" th:method="post" th:object="${order}">
        <div class="row col-md-12">
            <div class="input-group mb-3">
                <span class="input-group-text">Имя и фамилия</span>
                <input type="text" name="name" th:field="*{name}" class="form-control">
                <input type="text" name="surname" th:field="*{surname}" class="form-control">
            </div>
            <div th:if="${#fields.hasErrors('name')}" th:errors="*{name}">Name Error</div>
            <div th:if="${#fields.hasErrors('surname')}" th:errors="*{surname}">Surname Error</div>

            <div class="input-group mb-3">
                <span class="input-group-text" id="inputGroup-sizing-default">Адрес</span>
                <input type="text" class="form-control" name="address" th:field="*{address}" aria-describedby="inputGroup-sizing-default">
            </div>
            <div th:if="${#fields.hasErrors('address')}" th:errors="*{address}">Address Error</div>

            <div class="input-group mb-3">
                <select class="form-select" name="receivingWay">
                    <option selected>Доставка (5.00 руб.)</option>
                    <option value="Самовывоз из магазина по адресу такому-то">Самовывоз из магазина по адресу такому-то (бесплатно)</option>
                </select>
            </div>
        </div>

        <div class="col-12 ">
            <button class="btn btn-primary mt-4 offset-md-1" type="submit">Подтвердить и оформить заказ</button>
        </div>
    </form>
</div>

<footer th:insert="fragment/footer"></footer>

<script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js}"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>

